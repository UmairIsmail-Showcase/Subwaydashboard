<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Subway Training Excellence Dashboard</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Trebuchet MS', 'Arial Black', Arial, sans-serif;
            background: #f8fafc;
            min-height: 100%;
            color: #1a202c;
        }

        .dashboard-container {
            min-height: 100vh;
            padding: 24px;
        }

        .glass-container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            border: 3px solid #00923f;
            padding: 32px;
            box-shadow: 0 25px 50px rgba(0, 146, 63, 0.2), inset 0 1px 0 rgba(255, 204, 2, 0.3);
            position: relative;
            overflow: hidden;
        }

        .glass-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: #00923f;
        }

        .header {
            text-align: center;
            margin-bottom: 48px;
            color: white;
        }

        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 24px;
        }

        .subway-logo {
            width: 80px;
            height: 80px;
            background: #00923f;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            font-weight: 800;
            color: #ffcc02;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 3px solid #ffcc02;
        }

        .header h1 {
            font-size: 3.5rem;
            font-weight: 800;
            color: #00923f;
            margin-bottom: 12px;
            letter-spacing: -2px;
            font-family: 'Trebuchet MS', 'Arial Black', Arial, sans-serif;
        }

        .header p {
            font-size: 1.2rem;
            color: #00923f;
            font-weight: 600;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-bottom: 48px;
        }

        .stat-card {
            background: #ffffff;
            border-radius: 16px;
            padding: 32px 24px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
            border-left: 4px solid #00923f;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        .stat-icon {
            width: 64px;
            height: 64px;
            margin: 0 auto 20px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            background: #ffcc02;
            color: #00923f;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 2px solid #00923f;
        }

        .stat-number {
            font-size: 3rem;
            font-weight: 800;
            color: #00923f;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 0.95rem;
            color: #64748b;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr;
            gap: 24px;
            margin-bottom: 32px;
        }

        .toggle-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .toggle-header {
            padding: 20px 32px;
            background: #ffcc02;
            color: #1a202c;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
            user-select: none;
            border: 2px solid #00923f;
            border-bottom: none;
            font-weight: 700;
        }



        .toggle-header:hover {
            background: #e6b800;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .toggle-title {
            font-size: 1.3rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .toggle-icon {
            font-size: 1.2rem;
            transition: transform 0.3s ease;
        }

        .toggle-icon.rotated {
            transform: rotate(180deg);
        }

        .toggle-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .toggle-content.expanded {
            max-height: 2000px;
        }

        .toggle-inner {
            padding: 32px;
        }

        .compact-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .compact-stat {
            background: #ffffff;
            border-radius: 12px;
            padding: 16px 12px;
            text-align: center;
            border: 1px solid #e2e8f0;
            border-top: 3px solid #00923f;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .compact-stat:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .compact-stat-icon {
            font-size: 1.5rem;
            margin-bottom: 8px;
            filter: drop-shadow(0 2px 4px rgba(0, 146, 63, 0.2));
        }

        .compact-stat-number {
            font-size: 1.8rem;
            font-weight: 800;
            color: #00923f;
            margin-bottom: 4px;
        }

        .compact-stat-label {
            font-size: 0.8rem;
            color: #64748b;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .mobile-optimized {
            display: none;
        }

        .content-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 32px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1a202c;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .card-title::before {
            content: '';
            width: 4px;
            height: 24px;
            background: #00923f;
            border-radius: 2px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 24px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-size: 0.9rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-group input,
        .form-group select {
            padding: 16px 20px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 500;
            background: white;
            transition: all 0.3s ease;
            color: #1a202c;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #00923f;
            box-shadow: 0 0 0 3px rgba(0, 146, 63, 0.1);
            transform: translateY(-2px);
        }

        .btn-primary {
            background: #00923f;
            color: white;
            border: 2px solid #00923f;
            padding: 16px 32px;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            font-family: 'Trebuchet MS', 'Arial Black', Arial, sans-serif;
        }



        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            background: #007a35;
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .records-section {
            grid-column: 1 / -1;
        }

        .progress-container {
            margin-bottom: 24px;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .progress-text {
            font-size: 0.9rem;
            font-weight: 600;
            color: #374151;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: #f3f4f6;
            border-radius: 6px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .progress-fill {
            height: 100%;
            background: #00923f;
            border-radius: 6px;
            transition: width 0.8s ease;
        }



        .record-card {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 16px;
            transition: all 0.3s ease;
            border-left: 4px solid #00923f;
        }

        .record-card:hover {
            transform: translateX(4px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border-left-color: #ffcc02;
        }

        .record-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .record-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: #1a202c;
            margin-bottom: 4px;
        }

        .record-meta {
            font-size: 0.9rem;
            color: #64748b;
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
        }

        .certification-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .certified {
            background: #10b981;
            color: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .pending {
            background: #f59e0b;
            color: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .needs-retrain {
            background: #ef4444;
            color: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .empty-state {
            text-align: center;
            padding: 64px 32px;
            color: #64748b;
        }

        .empty-icon {
            font-size: 4rem;
            margin-bottom: 24px;
            opacity: 0.5;
        }

        .empty-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #374151;
            margin-bottom: 12px;
        }

        .empty-text {
            font-size: 1rem;
            line-height: 1.6;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .toast {
            position: fixed;
            top: 24px;
            right: 24px;
            background: rgba(0, 146, 63, 0.95);
            color: white;
            padding: 16px 24px;
            border-radius: 12px;
            font-weight: 600;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transform: translateX(400px);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.error {
            background: rgba(239, 68, 68, 0.95);
        }

        .quick-actions {
            display: flex;
            gap: 12px;
            margin-top: 24px;
            flex-wrap: wrap;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .charts-section {
            margin-bottom: 32px;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin-top: 24px;
        }

        .chart-container {
            background: #f8fafc;
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            border: 1px solid #e2e8f0;
            min-height: 300px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .chart-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            line-height: 1.2;
            padding-bottom: 8px;
            border-bottom: 2px solid #e2e8f0;
        }

        canvas {
            max-width: 100%;
            height: auto;
        }

        @media (max-width: 1024px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }

            .charts-grid {
                grid-template-columns: 1fr;
            }

            .toggle-header {
                padding: 16px 24px;
            }

            .toggle-title {
                font-size: 1.1rem;
            }

            .toggle-inner {
                padding: 24px;
            }
        }

        .tna-loading {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 40px;
            color: #64748b;
            font-style: italic;
        }

        .tna-content {
            display: none;
        }

        .tna-content.show {
            display: block;
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .tna-section {
            margin-bottom: 32px;
            padding: 24px;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 16px;
            border-left: 4px solid #00923f;
        }

        .tna-section h3 {
            font-size: 1.2rem;
            font-weight: 700;
            color: #1a202c;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tna-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .tna-metric {
            background: white;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .tna-metric-value {
            font-size: 2rem;
            font-weight: 800;
            margin-bottom: 8px;
        }

        .tna-metric-label {
            font-size: 0.9rem;
            color: #64748b;
            font-weight: 500;
        }

        .critical { color: #ef4444; }
        .warning { color: #f59e0b; }
        .good { color: #10b981; }
        .excellent { color: #00923f; }

        .recommendation-list {
            list-style: none;
            padding: 0;
        }

        .recommendation-item {
            background: white;
            margin-bottom: 12px;
            padding: 16px 20px;
            border-radius: 12px;
            border-left: 4px solid #ffcc02;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .recommendation-item.high-priority {
            border-left-color: #ef4444;
        }

        .recommendation-item.medium-priority {
            border-left-color: #f59e0b;
        }

        .recommendation-item.low-priority {
            border-left-color: #10b981;
        }

        .recommendation-icon {
            font-size: 1.2rem;
            margin-top: 2px;
        }

        .recommendation-content h4 {
            font-size: 1rem;
            font-weight: 700;
            color: #1a202c;
            margin-bottom: 4px;
        }

        .recommendation-content p {
            font-size: 0.9rem;
            color: #64748b;
            margin: 0;
            line-height: 1.5;
        }

        .priority-badge {
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            padding: 4px 8px;
            border-radius: 6px;
            letter-spacing: 0.5px;
            margin-left: auto;
            white-space: nowrap;
        }

        .priority-high {
            background: #fef2f2;
            color: #dc2626;
        }

        .priority-medium {
            background: #fffbeb;
            color: #d97706;
        }

        .priority-low {
            background: #f0fdf4;
            color: #16a34a;
        }

        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        .insight-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .insight-icon {
            font-size: 2rem;
            margin-bottom: 12px;
        }

        .insight-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
        }

        .insight-value {
            font-size: 1.1rem;
            font-weight: 700;
            color: #1a202c;
        }

        @media (max-width: 768px) {
            .dashboard-container {
                padding: 12px;
            }
            
            .glass-container {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2.2rem;
                letter-spacing: -1px;
            }

            .header p {
                font-size: 1rem;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 16px;
            }

            .stat-card {
                padding: 20px 16px;
            }

            .stat-number {
                font-size: 2.2rem;
            }

            .tna-grid {
                grid-template-columns: 1fr;
            }

            .insights-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .toggle-header {
                padding: 14px 20px;
            }

            .toggle-title {
                font-size: 1rem;
            }

            .toggle-inner {
                padding: 20px;
            }

            .form-grid {
                gap: 16px;
            }

            .compact-stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }

            .mobile-optimized {
                display: block;
            }

            .desktop-only {
                display: none;
            }

            .quick-actions {
                justify-content: center;
            }

            .btn-secondary {
                padding: 10px 20px;
                font-size: 0.85rem;
            }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="dashboard-container">
   <div class="glass-container">
    <header class="header">
     <div class="logo-container">
      <div class="subway-logo">
       S
      </div>
      <div>
       <h1 id="dashboard-title">Training Excellence</h1>
       <p id="company-name">Subway Restaurants</p>
      </div>
     </div>
     <p>Training Manager: <strong id="manager-name">Asad</strong></p>
     <div class="quick-actions"><button class="btn-secondary" onclick="exportData()">üì§ Export Report</button>
     </div>
    </header><!-- Compact Stats Overview -->
    <div class="compact-stats">
     <div class="compact-stat">
      <div class="compact-stat-icon">
       üë•
      </div>
      <div class="compact-stat-number" id="compact-total">
       0
      </div>
      <div class="compact-stat-label">
       Total Trained
      </div>
     </div>
     <div class="compact-stat">
      <div class="compact-stat-icon">
       üèÜ
      </div>
      <div class="compact-stat-number" id="compact-certified">
       0
      </div>
      <div class="compact-stat-label">
       Certified
      </div>
     </div>
     <div class="compact-stat">
      <div class="compact-stat-icon">
       üìà
      </div>
      <div class="compact-stat-number" id="compact-avg">
       0%
      </div>
      <div class="compact-stat-label">
       Avg Score
      </div>
     </div>
     <div class="compact-stat">
      <div class="compact-stat-icon">
       ‚è±Ô∏è
      </div>
      <div class="compact-stat-number" id="compact-pending">
       0
      </div>
      <div class="compact-stat-label">
       Pending
      </div>
     </div>
    </div><!-- Analytics Toggle Section -->
    <div class="toggle-section desktop-only">
     <div class="toggle-header" onclick="toggleSection('analytics')">
      <div class="toggle-title">
       üìä Performance Analytics
      </div>
      <div class="toggle-icon" id="analytics-icon">
       ‚ñº
      </div>
     </div>
     <div class="toggle-content" id="analytics-content">
      <div class="toggle-inner">
       <div class="charts-grid">
        <div class="chart-container">
         <h3 class="chart-title">Training Module Distribution</h3>
         <canvas id="moduleChart" width="300" height="220"></canvas>
        </div>
        <div class="chart-container">
         <h3 class="chart-title">Score Distribution</h3>
         <canvas id="scoreChart" width="300" height="220"></canvas>
        </div>
        <div class="chart-container">
         <h3 class="chart-title">Certification Status</h3>
         <canvas id="statusChart" width="300" height="220"></canvas>
        </div>
        <div class="chart-container">
         <h3 class="chart-title">Monthly Training Trend</h3>
         <canvas id="trendChart" width="300" height="220"></canvas>
        </div>
       </div>
      </div>
     </div>
    </div>
    <div class="main-content"><!-- TNA Toggle Section -->
     <div class="toggle-section">
      <div class="toggle-header" onclick="toggleSection('tna')">
       <div class="toggle-title">
        üéØ Training Needs Analysis &amp; Recommendations
       </div>
       <div class="toggle-icon" id="tna-icon">
        ‚ñº
       </div>
      </div>
      <div class="toggle-content" id="tna-content">
       <div class="toggle-inner">
        <div id="tna-summary">
         <div class="tna-loading">
          <div class="loading-spinner"></div><span>Analyzing training data and generating recommendations...</span>
         </div>
        </div>
       </div>
      </div>
     </div><!-- Add Training Record Toggle Section -->
     <div class="toggle-section">
      <div class="toggle-header" onclick="toggleSection('form')">
       <div class="toggle-title">
        ‚ûï Add Training Record
       </div>
       <div class="toggle-icon" id="form-icon">
        ‚ñº
       </div>
      </div>
      <div class="toggle-content" id="form-content">
       <div class="toggle-inner">
        <form id="training-form">
         <div class="form-grid">
          <div class="form-group"><label for="store-id">Store ID</label> <input type="text" id="store-id" placeholder="SUB001" required>
          </div>
          <div class="form-group"><label for="staff-name">Staff Name</label> <input type="text" id="staff-name" placeholder="John Smith" required>
          </div>
          <div class="form-group"><label for="training-module">Training Module</label> <select id="training-module" required> <option value="">Select Module</option> <option value="Food Safety &amp; Hygiene">Food Safety &amp; Hygiene</option> <option value="Customer Service">Customer Service</option> <option value="Sandwich Making">Sandwich Making</option> <option value="Cash Handling">Cash Handling</option> <option value="Store Operations">Store Operations</option> <option value="Leadership">Leadership</option> </select>
          </div>
          <div class="form-group"><label for="score">Score (%)</label> <input type="number" id="score" min="0" max="100" placeholder="85" required>
          </div>
          <div class="form-group"><label for="certification-status">Status</label> <select id="certification-status" required> <option value="">Select Status</option> <option value="Certified">Certified</option> <option value="Pending">Pending</option> <option value="Needs Retrain">Needs Retrain</option> </select>
          </div>
          <div class="form-group"><label for="notes">Notes</label> <input type="text" id="notes" placeholder="Additional comments...">
          </div>
         </div><button type="submit" class="btn-primary" id="submit-btn"> Add Training Record </button>
        </form>
       </div>
      </div>
     </div><!-- Training Records Section (Always Visible) -->
     <div class="content-card records-section">
      <h2 class="card-title">üìö Training Records</h2>
      <div class="progress-container">
       <div class="progress-label"><span class="progress-text">Overall Certification Rate</span> <span class="progress-text" id="progress-percentage">0%</span>
       </div>
       <div class="progress-bar">
        <div class="progress-fill" id="overall-progress" style="width: 0%"></div>
       </div>
      </div>
      <div id="records-container">
       <div class="empty-state">
        <div class="empty-icon">
         üìö
        </div>
        <h3 class="empty-title">No Training Records</h3>
        <p class="empty-text">Add your first training record or generate sample data to get started!</p>
       </div>
      </div>
     </div>
    </div>
   </div>
  </div>
  <div id="toast" class="toast"></div>
  <script>
        let trainingRecords = [];
        let recordCount = 0;
        let currentPage = 1;
        const recordsPerPage = 7;
        
        const defaultConfig = {
            dashboard_title: "Training Excellence",
            company_name: "Subway Restaurants",
            manager_name: "Asad"
        };

        // Data SDK Handler
        const dataHandler = {
            onDataChanged(data) {
                trainingRecords = data;
                updateStats();
                renderRecords();
            }
        };

        // Element SDK Configuration
        async function onConfigChange(config) {
            const dashboardTitle = config.dashboard_title || defaultConfig.dashboard_title;
            const companyName = config.company_name || defaultConfig.company_name;
            const managerName = config.manager_name || defaultConfig.manager_name;

            document.getElementById('dashboard-title').textContent = dashboardTitle;
            document.getElementById('company-name').textContent = companyName;
            document.getElementById('manager-name').textContent = managerName;
        }

        function mapToCapabilities(config) {
            return {
                recolorables: [],
                borderables: [],
                fontEditable: undefined,
                fontSizeable: undefined
            };
        }

        function mapToEditPanelValues(config) {
            return new Map([
                ["dashboard_title", config.dashboard_title || defaultConfig.dashboard_title],
                ["company_name", config.company_name || defaultConfig.company_name],
                ["manager_name", config.manager_name || defaultConfig.manager_name]
            ]);
        }

        // Initialize SDKs
        async function initializeApp() {
            try {
                if (window.dataSdk) {
                    const initResult = await window.dataSdk.init(dataHandler);
                    if (!initResult.isOk) {
                        showToast('Failed to initialize data storage', 'error');
                    }
                }

                if (window.elementSdk) {
                    await window.elementSdk.init({
                        defaultConfig,
                        onConfigChange,
                        mapToCapabilities,
                        mapToEditPanelValues
                    });
                }
            } catch (error) {
                showToast('Initialization error occurred', 'error');
            }
        }

        // Form submission
        document.getElementById('training-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (recordCount >= 999) {
                showToast('Maximum limit of 999 training records reached. Please delete some records first.', 'error');
                return;
            }

            const submitBtn = document.getElementById('submit-btn');
            const originalText = submitBtn.textContent;
            submitBtn.innerHTML = '<span class="loading-spinner"></span> Adding...';
            submitBtn.disabled = true;

            try {
                const formData = {
                    store_id: document.getElementById('store-id').value,
                    staff_name: document.getElementById('staff-name').value,
                    training_module: document.getElementById('training-module').value,
                    completion_date: new Date().toISOString(),
                    score: parseInt(document.getElementById('score').value),
                    certification_status: document.getElementById('certification-status').value,
                    notes: document.getElementById('notes').value || 'No additional notes'
                };

                if (window.dataSdk) {
                    const result = await window.dataSdk.create(formData);
                    if (result.isOk) {
                        showToast('‚úÖ Training record added successfully!');
                        document.getElementById('training-form').reset();
                    } else {
                        showToast('Failed to save training record', 'error');
                    }
                }
            } catch (error) {
                showToast('Error adding training record', 'error');
            } finally {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        });

        // Toggle functionality
        function toggleSection(sectionId) {
            const content = document.getElementById(sectionId + '-content');
            const icon = document.getElementById(sectionId + '-icon');
            
            if (content.classList.contains('expanded')) {
                content.classList.remove('expanded');
                icon.classList.remove('rotated');
                icon.textContent = '‚ñº';
            } else {
                content.classList.add('expanded');
                icon.classList.add('rotated');
                icon.textContent = '‚ñ≤';
                
                // If opening analytics section, render charts
                if (sectionId === 'analytics') {
                    setTimeout(() => {
                        renderCharts();
                    }, 400);
                }
            }
        }

        function updateStats() {
            recordCount = trainingRecords.length;
            const certifiedCount = trainingRecords.filter(r => r.certification_status === 'Certified').length;
            const pendingCount = trainingRecords.filter(r => r.certification_status === 'Pending').length;
            const avgScore = recordCount > 0 ? Math.round(trainingRecords.reduce((sum, r) => sum + r.score, 0) / recordCount) : 0;
            const certificationRate = recordCount > 0 ? Math.round((certifiedCount / recordCount) * 100) : 0;

            // Update compact stats
            document.getElementById('compact-total').textContent = recordCount;
            document.getElementById('compact-certified').textContent = certifiedCount;
            document.getElementById('compact-pending').textContent = pendingCount;
            document.getElementById('compact-avg').textContent = avgScore + '%';
            
            // Update progress bar
            document.getElementById('progress-percentage').textContent = certificationRate + '%';
            document.getElementById('overall-progress').style.width = certificationRate + '%';
            
            // Update TNA analysis when stats change
            if (recordCount > 0) {
                generateTNAAnalysis();
            }
        }

        function renderRecords() {
            const container = document.getElementById('records-container');
            
            if (trainingRecords.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üìö</div>
                        <h3 class="empty-title">No Training Records</h3>
                        <p class="empty-text">Add your first training record or generate sample data to get started!</p>
                    </div>
                `;
                return;
            }

            // Calculate pagination
            const totalPages = Math.ceil(trainingRecords.length / recordsPerPage);
            const startIndex = (currentPage - 1) * recordsPerPage;
            const endIndex = startIndex + recordsPerPage;
            const currentRecords = trainingRecords.slice(startIndex, endIndex);

            const recordsHtml = currentRecords.map(record => {
                const date = new Date(record.completion_date).toLocaleDateString();
                const statusClass = record.certification_status.toLowerCase().replace(' ', '-');
                
                return `
                    <div class="record-card">
                        <div class="record-header">
                            <div>
                                <div class="record-title">${record.staff_name} - ${record.training_module}</div>
                                <div class="record-meta">
                                    <span>üè™ ${record.store_id}</span>
                                    <span>üìä ${record.score}%</span>
                                    <span>üìÖ ${date}</span>
                                </div>
                            </div>
                            <div class="certification-badge ${statusClass}">
                                ${record.certification_status}
                            </div>
                        </div>
                        <p style="color: #64748b; font-size: 0.9rem; margin: 0;"><strong>Notes:</strong> ${record.notes}</p>
                    </div>
                `;
            }).join('');

            // Pagination controls
            const paginationHtml = totalPages > 1 ? `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 24px; padding: 20px; background: #f8fafc; border-radius: 12px; border: 1px solid #e2e8f0;">
                    <div style="color: #64748b; font-size: 0.9rem;">
                        Showing ${startIndex + 1}-${Math.min(endIndex, trainingRecords.length)} of ${trainingRecords.length} records
                    </div>
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <button onclick="changePage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''} 
                                style="padding: 8px 16px; border: 1px solid #e2e8f0; background: white; border-radius: 8px; cursor: ${currentPage === 1 ? 'not-allowed' : 'pointer'}; opacity: ${currentPage === 1 ? '0.5' : '1'}; font-size: 0.9rem; font-weight: 600;">
                            ‚Üê Previous
                        </button>
                        <span style="color: #374151; font-weight: 600; margin: 0 12px;">
                            Page ${currentPage} of ${totalPages}
                        </span>
                        <button onclick="changePage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''} 
                                style="padding: 8px 16px; border: 1px solid #e2e8f0; background: white; border-radius: 8px; cursor: ${currentPage === totalPages ? 'not-allowed' : 'pointer'}; opacity: ${currentPage === totalPages ? '0.5' : '1'}; font-size: 0.9rem; font-weight: 600;">
                            Next ‚Üí
                        </button>
                    </div>
                </div>
            ` : '';

            container.innerHTML = recordsHtml + paginationHtml;
        }

        function changePage(newPage) {
            const totalPages = Math.ceil(trainingRecords.length / recordsPerPage);
            if (newPage >= 1 && newPage <= totalPages) {
                currentPage = newPage;
                renderRecords();
            }
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type}`;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Comprehensive embedded sample data - loads automatically for offline demo
        const embeddedSampleData = [
            // January 2025 - Initial Training Wave
            { store_id: 'SUB001', staff_name: 'Sarah Johnson', training_module: 'Food Safety & Hygiene', score: 92, certification_status: 'Certified', notes: 'Excellent performance, ready for advanced training', completion_date: '2025-01-15T10:30:00.000Z' },
            { store_id: 'SUB002', staff_name: 'Mike Chen', training_module: 'Customer Service', score: 88, certification_status: 'Certified', notes: 'Great customer interaction skills', completion_date: '2025-01-18T14:20:00.000Z' },
            { store_id: 'SUB001', staff_name: 'Emily Davis', training_module: 'Sandwich Making', score: 76, certification_status: 'Pending', notes: 'Needs practice with portion control', completion_date: '2025-01-20T09:15:00.000Z' },
            { store_id: 'SUB003', staff_name: 'James Wilson', training_module: 'Cash Handling', score: 95, certification_status: 'Certified', notes: 'Perfect accuracy in transactions', completion_date: '2025-01-22T11:45:00.000Z' },
            { store_id: 'SUB002', staff_name: 'Lisa Rodriguez', training_module: 'Store Operations', score: 68, certification_status: 'Needs Retrain', notes: 'Requires additional support with closing procedures', completion_date: '2025-01-25T16:30:00.000Z' },
            { store_id: 'SUB004', staff_name: 'David Park', training_module: 'Leadership', score: 91, certification_status: 'Certified', notes: 'Natural leadership qualities, mentor material', completion_date: '2025-01-28T13:10:00.000Z' },
            { store_id: 'SUB003', staff_name: 'Maria Garcia', training_module: 'Food Safety & Hygiene', score: 85, certification_status: 'Certified', notes: 'Solid understanding of safety protocols', completion_date: '2025-01-30T08:45:00.000Z' },
            
            // February 2025 - Expansion Phase
            { store_id: 'SUB001', staff_name: 'Alex Thompson', training_module: 'Customer Service', score: 79, certification_status: 'Pending', notes: 'Good progress, needs confidence building', completion_date: '2025-02-02T15:20:00.000Z' },
            { store_id: 'SUB005', staff_name: 'Jennifer Lee', training_module: 'Sandwich Making', score: 89, certification_status: 'Certified', notes: 'Excellent technique and speed', completion_date: '2025-02-05T11:30:00.000Z' },
            { store_id: 'SUB004', staff_name: 'Robert Kim', training_module: 'Cash Handling', score: 72, certification_status: 'Pending', notes: 'Improving accuracy with practice', completion_date: '2025-02-08T09:45:00.000Z' },
            { store_id: 'SUB002', staff_name: 'Amanda White', training_module: 'Food Safety & Hygiene', score: 94, certification_status: 'Certified', notes: 'Outstanding knowledge of HACCP principles', completion_date: '2025-02-12T14:15:00.000Z' },
            { store_id: 'SUB006', staff_name: 'Carlos Martinez', training_module: 'Store Operations', score: 83, certification_status: 'Certified', notes: 'Strong operational understanding', completion_date: '2025-02-15T10:20:00.000Z' },
            { store_id: 'SUB003', staff_name: 'Rachel Green', training_module: 'Leadership', score: 87, certification_status: 'Certified', notes: 'Shows great potential for management', completion_date: '2025-02-18T16:40:00.000Z' },
            { store_id: 'SUB001', staff_name: 'Tom Anderson', training_module: 'Customer Service', score: 65, certification_status: 'Needs Retrain', notes: 'Struggles with difficult customers', completion_date: '2025-02-22T13:25:00.000Z' },
            { store_id: 'SUB005', staff_name: 'Nina Patel', training_module: 'Sandwich Making', score: 91, certification_status: 'Certified', notes: 'Creative and efficient sandwich artist', completion_date: '2025-02-25T12:10:00.000Z' },
            
            // March 2025 - Quality Focus
            { store_id: 'SUB007', staff_name: 'Kevin Brown', training_module: 'Food Safety & Hygiene', score: 78, certification_status: 'Pending', notes: 'Good understanding, minor gaps in temperature control', completion_date: '2025-03-03T09:30:00.000Z' },
            { store_id: 'SUB004', staff_name: 'Sophie Turner', training_module: 'Cash Handling', score: 96, certification_status: 'Certified', notes: 'Exceptional accuracy and speed', completion_date: '2025-03-06T11:15:00.000Z' },
            { store_id: 'SUB002', staff_name: 'Marcus Johnson', training_module: 'Store Operations', score: 74, certification_status: 'Pending', notes: 'Needs more practice with inventory management', completion_date: '2025-03-10T14:45:00.000Z' },
            { store_id: 'SUB006', staff_name: 'Isabella Chen', training_module: 'Leadership', score: 93, certification_status: 'Certified', notes: 'Excellent communication and team building skills', completion_date: '2025-03-13T10:50:00.000Z' },
            { store_id: 'SUB003', staff_name: 'Daniel Wilson', training_module: 'Customer Service', score: 86, certification_status: 'Certified', notes: 'Natural people person, great with complaints', completion_date: '2025-03-17T15:30:00.000Z' },
            { store_id: 'SUB008', staff_name: 'Olivia Davis', training_module: 'Sandwich Making', score: 82, certification_status: 'Certified', notes: 'Consistent quality and presentation', completion_date: '2025-03-20T12:40:00.000Z' },
            { store_id: 'SUB001', staff_name: 'Ryan Miller', training_module: 'Food Safety & Hygiene', score: 69, certification_status: 'Needs Retrain', notes: 'Requires reinforcement on cross-contamination prevention', completion_date: '2025-03-24T08:20:00.000Z' },
            { store_id: 'SUB005', staff_name: 'Grace Liu', training_module: 'Cash Handling', score: 88, certification_status: 'Certified', notes: 'Reliable and trustworthy with transactions', completion_date: '2025-03-27T16:10:00.000Z' },
            
            // April 2025 - Advanced Training
            { store_id: 'SUB007', staff_name: 'Ethan Rodriguez', training_module: 'Store Operations', score: 90, certification_status: 'Certified', notes: 'Ready for assistant manager role', completion_date: '2025-04-02T11:25:00.000Z' },
            { store_id: 'SUB004', staff_name: 'Zoe Thompson', training_module: 'Leadership', score: 85, certification_status: 'Certified', notes: 'Good motivational skills, developing delegation', completion_date: '2025-04-05T14:35:00.000Z' },
            { store_id: 'SUB009', staff_name: 'Lucas Garcia', training_module: 'Customer Service', score: 92, certification_status: 'Certified', notes: 'Exceptional at handling rush periods', completion_date: '2025-04-08T10:15:00.000Z' },
            { store_id: 'SUB002', staff_name: 'Mia Jackson', training_module: 'Sandwich Making', score: 77, certification_status: 'Pending', notes: 'Good technique, needs speed improvement', completion_date: '2025-04-12T13:50:00.000Z' },
            { store_id: 'SUB006', staff_name: 'Noah Williams', training_module: 'Food Safety & Hygiene', score: 95, certification_status: 'Certified', notes: 'Could mentor other staff on safety protocols', completion_date: '2025-04-15T09:40:00.000Z' },
            { store_id: 'SUB003', staff_name: 'Ava Martinez', training_module: 'Cash Handling', score: 81, certification_status: 'Certified', notes: 'Steady improvement in transaction speed', completion_date: '2025-04-18T15:20:00.000Z' },
            { store_id: 'SUB008', staff_name: 'Logan Brown', training_module: 'Store Operations', score: 73, certification_status: 'Pending', notes: 'Understanding concepts but needs practical application', completion_date: '2025-04-22T12:30:00.000Z' },
            { store_id: 'SUB001', staff_name: 'Emma Wilson', training_module: 'Leadership', score: 89, certification_status: 'Certified', notes: 'Natural leader with strong problem-solving skills', completion_date: '2025-04-25T11:45:00.000Z' },
            
            // May 2025 - Recent Completions
            { store_id: 'SUB010', staff_name: 'Mason Davis', training_module: 'Customer Service', score: 84, certification_status: 'Certified', notes: 'Friendly demeanor, good product knowledge', completion_date: '2025-05-01T14:10:00.000Z' },
            { store_id: 'SUB005', staff_name: 'Lily Anderson', training_module: 'Sandwich Making', score: 93, certification_status: 'Certified', notes: 'Artistic presentation and efficient workflow', completion_date: '2025-05-04T10:55:00.000Z' },
            { store_id: 'SUB007', staff_name: 'Jackson Lee', training_module: 'Food Safety & Hygiene', score: 87, certification_status: 'Certified', notes: 'Strong adherence to safety protocols', completion_date: '2025-05-08T16:25:00.000Z' },
            { store_id: 'SUB004', staff_name: 'Harper Kim', training_module: 'Cash Handling', score: 79, certification_status: 'Pending', notes: 'Accurate but needs to build confidence', completion_date: '2025-05-11T13:15:00.000Z' },
            { store_id: 'SUB009', staff_name: 'Aiden Garcia', training_module: 'Store Operations', score: 86, certification_status: 'Certified', notes: 'Well-rounded operational knowledge', completion_date: '2025-05-15T09:20:00.000Z' },
            { store_id: 'SUB002', staff_name: 'Chloe Martinez', training_module: 'Leadership', score: 91, certification_status: 'Certified', notes: 'Inspiring leader with clear communication', completion_date: '2025-05-18T12:05:00.000Z' },
            { store_id: 'SUB006', staff_name: 'Elijah Johnson', training_module: 'Customer Service', score: 75, certification_status: 'Pending', notes: 'Improving interpersonal skills', completion_date: '2025-05-22T15:40:00.000Z' },
            { store_id: 'SUB008', staff_name: 'Avery White', training_module: 'Sandwich Making', score: 88, certification_status: 'Certified', notes: 'Consistent quality and good time management', completion_date: '2025-05-25T11:30:00.000Z' }
        ];

        // Load embedded data automatically for offline demo
        function loadEmbeddedData() {
            trainingRecords = [...embeddedSampleData];
            updateStats();
            renderRecords();
            renderCharts();
            generateTNAAnalysis();
            showToast('üìä Demo data loaded - Dashboard ready for presentation!');
        }

        // Training Needs Analysis Generator
        function generateTNAAnalysis() {
            setTimeout(() => {
                const analysis = analyzeTNAData();
                renderTNAAnalysis(analysis);
            }, 2000); // Simulate analysis time
        }

        function analyzeTNAData() {
            if (trainingRecords.length === 0) {
                return null;
            }

            // Calculate key metrics
            const totalRecords = trainingRecords.length;
            const certifiedCount = trainingRecords.filter(r => r.certification_status === 'Certified').length;
            const pendingCount = trainingRecords.filter(r => r.certification_status === 'Pending').length;
            const needsRetrainCount = trainingRecords.filter(r => r.certification_status === 'Needs Retrain').length;
            const avgScore = Math.round(trainingRecords.reduce((sum, r) => sum + r.score, 0) / totalRecords);
            const certificationRate = Math.round((certifiedCount / totalRecords) * 100);

            // Module performance analysis
            const moduleStats = {};
            trainingRecords.forEach(record => {
                if (!moduleStats[record.training_module]) {
                    moduleStats[record.training_module] = { scores: [], certified: 0, total: 0 };
                }
                moduleStats[record.training_module].scores.push(record.score);
                moduleStats[record.training_module].total++;
                if (record.certification_status === 'Certified') {
                    moduleStats[record.training_module].certified++;
                }
            });

            // Calculate module averages and certification rates
            const moduleAnalysis = Object.keys(moduleStats).map(module => {
                const stats = moduleStats[module];
                const avgScore = Math.round(stats.scores.reduce((sum, score) => sum + score, 0) / stats.scores.length);
                const certRate = Math.round((stats.certified / stats.total) * 100);
                return {
                    module,
                    avgScore,
                    certificationRate: certRate,
                    totalTrained: stats.total,
                    performance: avgScore >= 85 ? 'excellent' : avgScore >= 75 ? 'good' : avgScore >= 65 ? 'warning' : 'critical'
                };
            }).sort((a, b) => a.avgScore - b.avgScore); // Sort by performance (worst first)

            // Store performance analysis
            const storeStats = {};
            trainingRecords.forEach(record => {
                if (!storeStats[record.store_id]) {
                    storeStats[record.store_id] = { scores: [], certified: 0, total: 0 };
                }
                storeStats[record.store_id].scores.push(record.score);
                storeStats[record.store_id].total++;
                if (record.certification_status === 'Certified') {
                    storeStats[record.store_id].certified++;
                }
            });

            const storeAnalysis = Object.keys(storeStats).map(store => {
                const stats = storeStats[store];
                const avgScore = Math.round(stats.scores.reduce((sum, score) => sum + score, 0) / stats.scores.length);
                const certRate = Math.round((stats.certified / stats.total) * 100);
                return {
                    store,
                    avgScore,
                    certificationRate: certRate,
                    totalTrained: stats.total,
                    performance: avgScore >= 85 ? 'excellent' : avgScore >= 75 ? 'good' : avgScore >= 65 ? 'warning' : 'critical'
                };
            }).sort((a, b) => a.avgScore - b.avgScore);

            // Generate recommendations
            const recommendations = generateRecommendations(moduleAnalysis, storeAnalysis, {
                totalRecords,
                certificationRate,
                avgScore,
                needsRetrainCount,
                pendingCount
            });

            return {
                overview: {
                    totalRecords,
                    certificationRate,
                    avgScore,
                    needsRetrainCount,
                    pendingCount,
                    certifiedCount
                },
                moduleAnalysis,
                storeAnalysis,
                recommendations,
                insights: generateInsights(moduleAnalysis, storeAnalysis, trainingRecords)
            };
        }

        function generateRecommendations(moduleAnalysis, storeAnalysis, overview) {
            const recommendations = [];

            // Critical module recommendations
            const criticalModules = moduleAnalysis.filter(m => m.performance === 'critical');
            criticalModules.forEach(module => {
                recommendations.push({
                    priority: 'high',
                    icon: 'üö®',
                    title: `Urgent: ${module.module} Training Overhaul`,
                    description: `Average score of ${module.avgScore}% requires immediate intervention. Consider redesigning curriculum and adding hands-on practice sessions.`,
                    action: 'Schedule intensive retraining sessions within 2 weeks'
                });
            });

            // Warning module recommendations
            const warningModules = moduleAnalysis.filter(m => m.performance === 'warning');
            warningModules.forEach(module => {
                recommendations.push({
                    priority: 'medium',
                    icon: '‚ö†Ô∏è',
                    title: `Improve ${module.module} Training`,
                    description: `Score of ${module.avgScore}% indicates room for improvement. Focus on practical application and assessment methods.`,
                    action: 'Review training materials and add supplementary resources'
                });
            });

            // Store-specific recommendations
            const underperformingStores = storeAnalysis.filter(s => s.performance === 'critical' || s.performance === 'warning');
            underperformingStores.slice(0, 2).forEach(store => {
                recommendations.push({
                    priority: store.performance === 'critical' ? 'high' : 'medium',
                    icon: 'üè™',
                    title: `${store.store} Needs Support`,
                    description: `Store average of ${store.avgScore}% suggests need for additional management support and mentoring programs.`,
                    action: 'Deploy training specialist for on-site coaching'
                });
            });

            // Certification rate recommendations
            if (overview.certificationRate < 70) {
                recommendations.push({
                    priority: 'high',
                    icon: 'üìà',
                    title: 'Boost Overall Certification Rate',
                    description: `Current rate of ${overview.certificationRate}% is below target. Focus on converting pending certifications and addressing retrain cases.`,
                    action: 'Implement accelerated certification program'
                });
            }

            // Pending cases recommendation
            if (overview.pendingCount > overview.totalRecords * 0.2) {
                recommendations.push({
                    priority: 'medium',
                    icon: '‚è≥',
                    title: 'Address Pending Certifications',
                    description: `${overview.pendingCount} pending cases need attention. Provide additional support and clear completion pathways.`,
                    action: 'Schedule follow-up assessments within 1 week'
                });
            }

            // Best practices recommendation
            const excellentModules = moduleAnalysis.filter(m => m.performance === 'excellent');
            if (excellentModules.length > 0) {
                recommendations.push({
                    priority: 'low',
                    icon: 'üåü',
                    title: 'Replicate Success Patterns',
                    description: `${excellentModules[0].module} shows excellent results (${excellentModules[0].avgScore}%). Apply these methods to other modules.`,
                    action: 'Document and share best practices across all training modules'
                });
            }

            return recommendations.slice(0, 6); // Limit to top 6 recommendations
        }

        function generateInsights(moduleAnalysis, storeAnalysis, records) {
            const insights = [];

            // Top performing module
            const topModule = moduleAnalysis.reduce((prev, current) => 
                (prev.avgScore > current.avgScore) ? prev : current
            );
            insights.push({
                icon: 'üèÜ',
                title: 'Top Module',
                value: `${topModule.module} (${topModule.avgScore}%)`
            });

            // Most challenging module
            const challengingModule = moduleAnalysis.reduce((prev, current) => 
                (prev.avgScore < current.avgScore) ? prev : current
            );
            insights.push({
                icon: 'üìö',
                title: 'Needs Focus',
                value: `${challengingModule.module} (${challengingModule.avgScore}%)`
            });

            // Top performing store
            const topStore = storeAnalysis.reduce((prev, current) => 
                (prev.avgScore > current.avgScore) ? prev : current
            );
            insights.push({
                icon: 'ü•á',
                title: 'Top Store',
                value: `${topStore.store} (${topStore.avgScore}%)`
            });

            // Training velocity
            const recentRecords = records.filter(r => {
                const recordDate = new Date(r.completion_date);
                const thirtyDaysAgo = new Date();
                thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                return recordDate >= thirtyDaysAgo;
            });
            insights.push({
                icon: '‚ö°',
                title: 'Recent Activity',
                value: `${recentRecords.length} trainings (30 days)`
            });

            return insights;
        }

        function renderTNAAnalysis(analysis) {
            const container = document.getElementById('tna-summary');
            
            if (!analysis) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üìä</div>
                        <h3 class="empty-title">No Analysis Available</h3>
                        <p class="empty-text">Add training records to generate TNA insights and recommendations.</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = `
                <div class="tna-content show">
                    <!-- Key Metrics Section -->
                    <div class="tna-section">
                        <h3>üìä Key Performance Indicators</h3>
                        <div class="tna-grid">
                            <div class="tna-metric">
                                <div class="tna-metric-value ${analysis.overview.certificationRate >= 80 ? 'excellent' : analysis.overview.certificationRate >= 70 ? 'good' : analysis.overview.certificationRate >= 60 ? 'warning' : 'critical'}">
                                    ${analysis.overview.certificationRate}%
                                </div>
                                <div class="tna-metric-label">Certification Rate</div>
                            </div>
                            <div class="tna-metric">
                                <div class="tna-metric-value ${analysis.overview.avgScore >= 85 ? 'excellent' : analysis.overview.avgScore >= 75 ? 'good' : analysis.overview.avgScore >= 65 ? 'warning' : 'critical'}">
                                    ${analysis.overview.avgScore}%
                                </div>
                                <div class="tna-metric-label">Average Score</div>
                            </div>
                            <div class="tna-metric">
                                <div class="tna-metric-value ${analysis.overview.needsRetrainCount === 0 ? 'excellent' : analysis.overview.needsRetrainCount <= 2 ? 'good' : analysis.overview.needsRetrainCount <= 5 ? 'warning' : 'critical'}">
                                    ${analysis.overview.needsRetrainCount}
                                </div>
                                <div class="tna-metric-label">Need Retraining</div>
                            </div>
                        </div>
                    </div>

                    <!-- Insights Section -->
                    <div class="tna-section">
                        <h3>üí° Quick Insights</h3>
                        <div class="insights-grid">
                            ${analysis.insights.map(insight => `
                                <div class="insight-card">
                                    <div class="insight-icon">${insight.icon}</div>
                                    <div class="insight-title">${insight.title}</div>
                                    <div class="insight-value">${insight.value}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <!-- Recommendations Section -->
                    <div class="tna-section">
                        <h3>üéØ Priority Recommendations</h3>
                        <ul class="recommendation-list">
                            ${analysis.recommendations.map(rec => `
                                <li class="recommendation-item ${rec.priority}-priority">
                                    <div class="recommendation-icon">${rec.icon}</div>
                                    <div class="recommendation-content">
                                        <h4>${rec.title}</h4>
                                        <p>${rec.description}</p>
                                        <p style="margin-top: 8px; font-weight: 600; color: #1a202c;"><strong>Action:</strong> ${rec.action}</p>
                                    </div>
                                    <div class="priority-badge priority-${rec.priority}">${rec.priority}</div>
                                </li>
                            `).join('')}
                        </ul>
                    </div>

                    <!-- Module Performance Section -->
                    <div class="tna-section">
                        <h3>üìö Module Performance Analysis</h3>
                        <div class="tna-grid">
                            ${analysis.moduleAnalysis.map(module => `
                                <div class="tna-metric">
                                    <div class="tna-metric-value ${module.performance}">
                                        ${module.avgScore}%
                                    </div>
                                    <div class="tna-metric-label">${module.module}</div>
                                    <div style="font-size: 0.8rem; color: #64748b; margin-top: 4px;">
                                        ${module.totalTrained} trained ‚Ä¢ ${module.certificationRate}% certified
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }



        function exportData() {
            if (trainingRecords.length === 0) {
                showToast('No data to export. Add some training records first!', 'error');
                return;
            }
            
            showToast('üì§ Exporting training data...');
            
            const headers = ['Store ID', 'Staff Name', 'Training Module', 'Score', 'Status', 'Date', 'Notes'];
            const csvContent = [
                headers.join(','),
                ...trainingRecords.map(record => [
                    record.store_id,
                    record.staff_name,
                    record.training_module,
                    record.score,
                    record.certification_status,
                    new Date(record.completion_date).toLocaleDateString(),
                    `"${record.notes}"`
                ].join(','))
            ].join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `subway_training_report_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            showToast('‚úÖ Training data exported successfully!');
        }

        async function clearAllData() {
            if (trainingRecords.length === 0) {
                showToast('No data to clear!', 'error');
                return;
            }
            
            showToast('üóëÔ∏è Clearing all training data...');
            
            for (const record of trainingRecords) {
                if (window.dataSdk) {
                    await window.dataSdk.delete(record);
                }
            }
            
            showToast('‚úÖ All data cleared successfully!');
        }

        // Chart rendering functions
        function renderCharts() {
            renderModuleChart();
            renderScoreChart();
            renderStatusChart();
            renderTrendChart();
        }

        function renderModuleChart() {
            const canvas = document.getElementById('moduleChart');
            const ctx = canvas.getContext('2d');
            
            // Count modules
            const moduleCounts = {};
            trainingRecords.forEach(record => {
                moduleCounts[record.training_module] = (moduleCounts[record.training_module] || 0) + 1;
            });

            const modules = Object.keys(moduleCounts);
            const counts = Object.values(moduleCounts);
            const colors = ['#00923f', '#ffcc02', '#ffffff', '#1a202c', '#007a35', '#e6b800'];

            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            if (modules.length === 0) {
                ctx.fillStyle = '#64748b';
                ctx.font = '16px -apple-system, BlinkMacSystemFont, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('No data available', canvas.width / 2, canvas.height / 2);
                return;
            }

            // Draw bar chart
            const barWidth = canvas.width / modules.length * 0.8;
            const maxCount = Math.max(...counts);
            const chartHeight = canvas.height - 60;

            modules.forEach((module, index) => {
                const barHeight = (counts[index] / maxCount) * chartHeight;
                const x = (canvas.width / modules.length) * index + (canvas.width / modules.length - barWidth) / 2;
                const y = canvas.height - barHeight - 30;

                // Draw bar
                ctx.fillStyle = colors[index % colors.length];
                ctx.fillRect(x, y, barWidth, barHeight);

                // Draw count on top
                ctx.fillStyle = '#1a202c';
                ctx.font = 'bold 14px -apple-system, BlinkMacSystemFont, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(counts[index], x + barWidth / 2, y - 5);

                // Draw label
                ctx.fillStyle = '#64748b';
                ctx.font = '10px -apple-system, BlinkMacSystemFont, sans-serif';
                ctx.save();
                ctx.translate(x + barWidth / 2, canvas.height - 5);
                ctx.rotate(-Math.PI / 4);
                ctx.fillText(module.substring(0, 12) + '...', 0, 0);
                ctx.restore();
            });
        }

        function renderScoreChart() {
            const canvas = document.getElementById('scoreChart');
            const ctx = canvas.getContext('2d');
            
            // Score ranges
            const ranges = { '90-100': 0, '80-89': 0, '70-79': 0, '60-69': 0, 'Below 60': 0 };
            
            trainingRecords.forEach(record => {
                const score = record.score;
                if (score >= 90) ranges['90-100']++;
                else if (score >= 80) ranges['80-89']++;
                else if (score >= 70) ranges['70-79']++;
                else if (score >= 60) ranges['60-69']++;
                else ranges['Below 60']++;
            });

            const labels = Object.keys(ranges);
            const values = Object.values(ranges);
            const colors = ['#00923f', '#ffcc02', '#ffffff', '#e6b800', '#1a202c'];

            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            if (trainingRecords.length === 0) {
                ctx.fillStyle = '#64748b';
                ctx.font = '16px -apple-system, BlinkMacSystemFont, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('No data available', canvas.width / 2, canvas.height / 2);
                return;
            }

            // Draw pie chart
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = Math.min(centerX, centerY) - 20;
            
            let currentAngle = -Math.PI / 2;
            const total = values.reduce((sum, val) => sum + val, 0);

            values.forEach((value, index) => {
                if (value > 0) {
                    const sliceAngle = (value / total) * 2 * Math.PI;
                    
                    // Draw slice
                    ctx.beginPath();
                    ctx.moveTo(centerX, centerY);
                    ctx.arc(centerX, centerY, radius, currentAngle, currentAngle + sliceAngle);
                    ctx.closePath();
                    ctx.fillStyle = colors[index];
                    ctx.fill();
                    
                    // Draw label
                    const labelAngle = currentAngle + sliceAngle / 2;
                    const labelX = centerX + Math.cos(labelAngle) * (radius * 0.7);
                    const labelY = centerY + Math.sin(labelAngle) * (radius * 0.7);
                    
                    ctx.fillStyle = 'white';
                    ctx.font = 'bold 12px -apple-system, BlinkMacSystemFont, sans-serif';
                    ctx.textAlign = 'center';
                    ctx.fillText(value, labelX, labelY);
                    
                    currentAngle += sliceAngle;
                }
            });

            // Draw legend
            labels.forEach((label, index) => {
                if (values[index] > 0) {
                    const legendY = 10 + index * 15;
                    ctx.fillStyle = colors[index];
                    ctx.fillRect(10, legendY, 12, 12);
                    ctx.fillStyle = '#1a202c';
                    ctx.font = '10px -apple-system, BlinkMacSystemFont, sans-serif';
                    ctx.textAlign = 'left';
                    ctx.fillText(label, 25, legendY + 9);
                }
            });
        }

        function renderStatusChart() {
            const canvas = document.getElementById('statusChart');
            const ctx = canvas.getContext('2d');
            
            // Count statuses
            const statusCounts = { 'Certified': 0, 'Pending': 0, 'Needs Retrain': 0 };
            trainingRecords.forEach(record => {
                statusCounts[record.certification_status]++;
            });

            const statuses = Object.keys(statusCounts);
            const counts = Object.values(statusCounts);
            const colors = ['#00923f', '#ffcc02', '#1a202c'];

            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            if (trainingRecords.length === 0) {
                ctx.fillStyle = '#64748b';
                ctx.font = '16px -apple-system, BlinkMacSystemFont, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('No data available', canvas.width / 2, canvas.height / 2);
                return;
            }

            // Draw donut chart with better spacing
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2 - 10; // Move chart up to make room for legend
            const outerRadius = Math.min(centerX, centerY) - 30; // Smaller radius for more space
            const innerRadius = outerRadius * 0.6;
            
            let currentAngle = -Math.PI / 2;
            const total = counts.reduce((sum, val) => sum + val, 0);

            counts.forEach((count, index) => {
                if (count > 0) {
                    const sliceAngle = (count / total) * 2 * Math.PI;
                    
                    // Draw slice
                    ctx.beginPath();
                    ctx.arc(centerX, centerY, outerRadius, currentAngle, currentAngle + sliceAngle);
                    ctx.arc(centerX, centerY, innerRadius, currentAngle + sliceAngle, currentAngle, true);
                    ctx.closePath();
                    ctx.fillStyle = colors[index];
                    ctx.fill();
                    
                    currentAngle += sliceAngle;
                }
            });

            // Draw center text
            ctx.fillStyle = '#1a202c';
            ctx.font = 'bold 20px -apple-system, BlinkMacSystemFont, sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText(total, centerX, centerY - 3);
            ctx.font = '10px -apple-system, BlinkMacSystemFont, sans-serif';
            ctx.fillText('Total', centerX, centerY + 12);

            // Draw horizontal legend at bottom with proper spacing
            const legendStartY = canvas.height - 35;
            const legendItemWidth = canvas.width / 3;
            
            statuses.forEach((status, index) => {
                if (counts[index] > 0) {
                    const legendX = index * legendItemWidth + 10;
                    
                    // Draw color box
                    ctx.fillStyle = colors[index];
                    ctx.fillRect(legendX, legendStartY, 12, 12);
                    
                    // Draw text with proper spacing
                    ctx.fillStyle = '#1a202c';
                    ctx.font = '10px -apple-system, BlinkMacSystemFont, sans-serif';
                    ctx.textAlign = 'left';
                    ctx.fillText(status, legendX + 16, legendStartY + 9);
                    ctx.fillText(`(${counts[index]})`, legendX + 16, legendStartY + 21);
                }
            });
        }

        function renderTrendChart() {
            const canvas = document.getElementById('trendChart');
            const ctx = canvas.getContext('2d');
            
            // Group by month
            const monthlyData = {};
            trainingRecords.forEach(record => {
                const date = new Date(record.completion_date);
                const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                monthlyData[monthKey] = (monthlyData[monthKey] || 0) + 1;
            });

            const months = Object.keys(monthlyData).sort();
            const counts = months.map(month => monthlyData[month]);

            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            if (months.length === 0) {
                ctx.fillStyle = '#64748b';
                ctx.font = '16px -apple-system, BlinkMacSystemFont, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('No data available', canvas.width / 2, canvas.height / 2);
                return;
            }

            // Draw line chart
            const padding = 40;
            const chartWidth = canvas.width - 2 * padding;
            const chartHeight = canvas.height - 2 * padding;
            const maxCount = Math.max(...counts);

            // Draw axes
            ctx.strokeStyle = '#e2e8f0';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, canvas.height - padding);
            ctx.lineTo(canvas.width - padding, canvas.height - padding);
            ctx.stroke();

            // Draw line
            ctx.strokeStyle = '#00923f';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            counts.forEach((count, index) => {
                const x = padding + (index / (counts.length - 1)) * chartWidth;
                const y = canvas.height - padding - (count / maxCount) * chartHeight;
                
                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
                
                // Draw point
                ctx.fillStyle = '#ffcc02';
                ctx.beginPath();
                ctx.arc(x, y, 4, 0, 2 * Math.PI);
                ctx.fill();
                
                // Draw value
                ctx.fillStyle = '#1a202c';
                ctx.font = '12px -apple-system, BlinkMacSystemFont, sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(count, x, y - 10);
            });
            
            ctx.stroke();

            // Draw month labels
            ctx.fillStyle = '#64748b';
            ctx.font = '10px Inter, sans-serif';
            ctx.textAlign = 'center';
            months.forEach((month, index) => {
                const x = padding + (index / (counts.length - 1)) * chartWidth;
                const shortMonth = month.split('-')[1] + '/' + month.split('-')[0].slice(2);
                ctx.fillText(shortMonth, x, canvas.height - 10);
            });
        }

        // Initialize the application
        initializeApp();
        
        // Load embedded data automatically for offline demo
        setTimeout(() => {
            loadEmbeddedData();
        }, 1000);
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99dd1c88c5939098',t:'MTc2MzAyNDc2OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>

</html>
